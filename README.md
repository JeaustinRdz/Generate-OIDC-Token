# Generate-OIDC-Token
This example is how to generate an OIDC token using azure DevOps and pipelines 

# Documentation Used in the example:

API documentation: https://learn.microsoft.com/en-us/rest/api/azure/devops/distributedtask/oidctoken/create?view=azure-devops-rest-7.1

PreDefine Variables documentation: https://learn.microsoft.com/en-us/azure/devops/pipelines/build/variables?view=azure-devops&tabs=yaml

BuildService Account scope: https://learn.microsoft.com/en-us/azure/devops/pipelines/process/access-tokens?view=azure-devops&tabs=yaml#job-authorization-scope

# Variables used in the example:
$(System.AccessToken) = Token generated for every run by the build identity, if you have a lack of permissions you need to review the identity Project Collection Build Service ({OrgName})

$(System.TeamProjectId) = Project GUID required by the api

$(System.PlanId) = A string-based identifier for a single pipeline run.

$(System.JobId) = A unique identifier for a single attempt of a single job. The value is unique to the current pipeline.

$org = Please make sure to change it to your organization Name 

$ServiceConnectionName = Please make sure to change it to your Service Connection name

$ClientId = Client ID of the AppRegistrations used in the service connection

$TenantId = Your Tenant ID

# Pipelines:
OIDCToken.yml = Example of how to use the Api

OIDCTokenWithServiceConnection.yml = Example of how to use the Api with additional parameters 

OIDCTokenLogin.yml = Example how to login in the pipeline with the OIDC token

# Use the OIDC token to authenticate in a pipeline
Pre requirements steps:

1- Go to portal, to the service principal that you are using in devops with the federal token and then go to certificates & secrets

2- Click in the credential that was generated by DevOps

3- Copy the Issuer, looks like: https://vstoken.dev.azure.com/########-####-####-####-############

(You can get the Issuer when you create a new service connection using workload identity federation with openid connect)

4- Go back and click in Add cretencial

5- Select "Other issuer"

6- Paste the Issuer that you copy in the step 3

7- Add the subject Identifier that will be p://{Your_Organization_Name}/{Your_Project_Nmae}/{Your_Pipeline_Name} example p://v-jeaustinro/JeaustinProject/Generate an OIDToken

8- Add the name that you required and save it

9- Use the pipeline OIDCTokenLogin.yml


# More information:

This documentation have an yaml example to generate an OIDC token using powershell script and predefine variables to guarantee the security and an easier automation



